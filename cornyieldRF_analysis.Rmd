---
title: "Corn Yield Random Forest"
author: "Britta Schumacher"
date: "Last updated: `r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document:
    theme: yeti
    toc: yes
    toc_float: true
    code_folding: hide
---

# Bring in the data, clean it up, and run the model on the training set
```{r}
library(randomForest)
library(tidyverse)
library(ggplot2)
library(caret)
library(ie2misc)
library(MLmetrics)

# pull in TRUE train data; all data with recorded yield
corn_yield <- readRDS("./data/yieldRF.RDS")

# remove ID variables that aren't included in the model, GEOID
yield_RF <- corn_yield %>% dplyr::select(-c(GEOID))

# specify qualitative variables that are factors
yield_RF$YEAR <- as.factor(yield_RF$YEAR)
yield_RF$FRR <- as.factor(yield_RF$FRR)

```

# Initial RF

Default parameters ~ mtry = 3, ntree = 500
```{r}
set.seed(1234) 
random_rn <- sample(nrow(yield_RF), ceiling(nrow(yield_RF)*.25)) 
train_fullset <- yield_RF[-random_rn,] 
test_fullset <- yield_RF[random_rn,] 

# biophysical
train <- train_fullset %>% select(-c(29:39))
test <- test_fullset %>% select(-c(29:39))

# biophysical
rf_yield <- randomForest(YIELD ~ ., data = train)
```

# Now let's predict on the test set
```{r}
preds <- predict(rf_yield, test, type = "response")
test$PREDICTIONS <- preds
head(test %>% dplyr::select(PREDICTIONS, YIELD))
```

# How well did our model do?
```{r}
MSE <- mean((test$YIELD - test$PREDICTIONS)^2)
print(MSE)
RMSE <- caret::RMSE(test$PREDICTIONS, test$YIELD)
print(RMSE)
R2 <- 1 - (sum((test$YIELD - test$PREDICTIONS)^2) / sum((test$YIELD - mean(test$YIELD))^2))
print(R2)
pR2 <- 1 - MSE / var(test$YIELD)
print(pR2)
mae <- mae(test$PREDICTIONS, test$YIELD)
mae
mape <- MAPE(test$PREDICTIONS, test$YIELD)
mape
```

# What are the most important variables?
```{r}
imp <- as.data.frame(varImpPlot(rf_yield))
```

# Nicer visualization
```{r}
imp$varnames <- rownames(imp) # row names to column
imp$varfull <- c("Year", "Shannon's Diversity Index", "Growing degree days", "Total precipitation", "Mean diurnal range", "Temperature seasonality", "Mean temperature of the warmest quarter", "Mean temperature of the driest quarter", "Precipitation seasonality", "Precipitation of the warmest quarter", "Precipitation of the coldest quarter", "Slope", "Elevation", "Subsoil pH", "Topsoil calcium carbonate", "Topsoil gypsum", "Topsoil cation exchange capacity ~ clay", "Topsoil cation exchange capacity ~ soil", "Topsoil sodicity", "Topsoil gravel content", "Topsoil organic carbon", "Topsoil reference bulk density", "Topsoil silt fraction", "Topsoil salinity", "Topsoil sand fraction", "Irrigation", "Farm resource region")

ggplot(imp, aes(x=reorder(varfull, IncNodePurity), y=IncNodePurity)) + 
  geom_point() +
  geom_segment(aes(x=varfull,xend=varfull,y=0,yend=IncNodePurity)) +
  ylab("Increase in node purity") +
  xlab("") +
  coord_flip() +
  theme_minimal()
```

# Reduced RF - top 19 most important variables (threshold made sense because it includes climate, topo, and the top three important soil characteristics based on expert feedback: T_CEC, T_OC, S_PH)
```{r}
# remove variables that contributed least to the full model
yield_RF_reduced <- yield_RF %>% 
  dplyr::select(YEAR,YIELD,PERC_IRR,FRR,GDD,BV2,BV18,SDI_CDL_AG,BV9,BV4,TP,ELEVATION,S_PH_H2O,SLOPE,BV8,BV19,T_CEC_SOIL,BV15,T_REF_BULK_DENSITY,T_OC)

train <- train %>%  dplyr::select(YEAR,YIELD,PERC_IRR,FRR,GDD,BV2,BV18,SDI_CDL_AG,BV9,BV4,TP,ELEVATION,S_PH_H2O,SLOPE,BV8,BV19,T_CEC_SOIL,BV15,T_REF_BULK_DENSITY,T_OC)

test <- test %>%  dplyr::select(YEAR,YIELD,PERC_IRR,FRR,GDD,BV2,BV18,SDI_CDL_AG,BV9,BV4,TP,ELEVATION,S_PH_H2O,SLOPE,BV8,BV19,T_CEC_SOIL,BV15,T_REF_BULK_DENSITY,T_OC)

rf_yield_reduced <- randomForest(YIELD ~ ., data = train)
```

# Now let's predict on the test set
```{r}
preds_red <- predict(rf_yield_reduced, test, type = "response")
test$PREDICTIONS <- preds_red
head(test %>% dplyr::select(PREDICTIONS, YIELD))
#saveRDS(test, file = './results/RFpreds_red.RDS')
```

# How well did our model do?
```{r}
MSE_red <- mean((test$YIELD - test$PREDICTIONS)^2)
print(MSE_red)
RMSE_red <- caret::RMSE(test$PREDICTIONS, test$YIELD)
print(RMSE_red)
R2_red <- 1 - (sum((test$YIELD - test$PREDICTIONS)^2) / sum((test$YIELD - mean(test$YIELD))^2))
print(R2_red)
pR2_red <- 1 - MSE_red / var(test$YIELD)
print(pR2_red)
mae_red <- mae(test$PREDICTIONS, test$YIELD)
mae_red
mape_red <- MAPE(test$PREDICTIONS, test$YIELD)
mape_red
```

Metrics barely change from full to reduced RF.

# What are the most important variables?
```{r}
imp_red <- as.data.frame(varImpPlot(rf_yield_reduced))
```

# Nicer visualization
```{r}
imp_red$varnames <- rownames(imp_red) # row names to column
imp_red$varfull <- c("Year", "Irrigation", "Farm resource region", "Growing Degree Days", "Mean diurnal range", "Precipitation of the warmest quarter", "Shannon's Diversity Index", "Mean temperature of the driest quarter", "Temperature seasonality", "Elevation", "Total precipitation", "Slope", "Mean temperature of the wettest quarter", "Precipitation of the coldest quarter", "Subsoil pH", "Precipitation seasonality",  "Topsoil cation exchange capacity ~ soil", "Topsoil reference bulk density", "Topsoil organic carbon")

imp_red <- imp_red %>%  mutate(Prop = IncNodePurity/sum(IncNodePurity)*100)

#saveRDS(imp_red, file = './results/RFimp_red.RDS')

imp_plot <- ggplot(imp_red, aes(x=reorder(varfull, IncNodePurity), y=IncNodePurity)) + 
  geom_point() +
  geom_segment(aes(x=varfull,xend=varfull,y=0,yend=IncNodePurity)) +
  ylab("Increase in node purity") +
  xlab("") +
  coord_flip() +
  theme_minimal()

imp_plot

#ggsave(imp_plot, file = './viz/RFimpplot_red.png', dpi = 300, width = 7, height = 7)
```
# Tune Biophysical RF

Default mtry = p/3 (so 19/3); but tuning suggests that mtry = 12 minimizing cross-validated RMSE!
```{r evaluate = FALSE}
control <- trainControl(method="repeatedcv", 
                        number=10, 
                        repeats=3, 
                        search="grid")
set.seed(1234)

tunegrid <- expand.grid(.mtry=c(1:12))

rf_gridsearch <- train(YIELD~., data=train, 
                       method="rf", 
                       metric='RMSE', 
                       ntree = 2000,
                       tuneGrid=tunegrid,
                       trControl = control)
print(rf_gridsearch)

jpeg("./viz/rf-tune-mtry2.jpeg", height = 4, width = 6, units = "in", res = 400)
plot(rf_gridsearch)
dev.off()

```
Random Forest 

12737 samples
   19 predictor ~ default ntrees = 500

No pre-processing
Resampling: Cross-Validated (10 fold, repeated 3 times) 
Summary of sample sizes: 11463, 11463, 11464, 11463, 11462, 11464, ... 
Resampling results across tuning parameters:

  mtry  RMSE      Rsquared   MAE     
   1    30.08711  0.6442456  23.84962
   2    21.61608  0.7622326  16.78247
   3    19.18015  0.7934285  14.70176
   4    18.48832  0.8016640  14.10895
   5    18.22066  0.8042397  13.87249
   6    18.10367  0.8048134  13.76500
   7    18.02260  0.8051778  13.68915
   8    17.97065  0.8051751  13.64230
   9    17.93063  0.8052253  13.60744
  10    17.93072  0.8044584  13.59464
  11    17.91163  0.8043202  13.57528
  12    17.92377  0.8034832  13.57159

RMSE was used to select the optimal model using the smallest value.
The final value used for the model was mtry = 11.

Random Forest 

12737 samples
   19 predictor ~ ntrees = 2000

No pre-processing
Resampling: Cross-Validated (10 fold, repeated 3 times) 
Summary of sample sizes: 11463, 11463, 11464, 11463, 11462, 11464, ... 
Resampling results across tuning parameters:

  mtry  RMSE      Rsquared   MAE     
   1    30.09296  0.6454033  23.85180
   2    21.59564  0.7636618  16.77102
   3    19.16431  0.7942486  14.69318
   4    18.47087  0.8022988  14.09545
   5    18.20506  0.8048216  13.85975
   6    18.07693  0.8055895  13.74367
   7    18.00142  0.8058497  13.67102
   8    17.94524  0.8059420  13.61931
   9    17.92014  0.8055923  13.59750
  10    17.90729  0.8051589  13.57500
  11    17.89944  0.8046973  13.56337
  12    17.89510  0.8042720  13.55620

RMSE was used to select the optimal model using the smallest value.
The final value used for the model was mtry = 12.

# Biophysical RF variable importance with various mtry levels
```{r evaluate = FALSE}
# remove variables that contributed least to the full model
rf_mtry <- function(mtry) {
  
  #index
  index <- mtry
  
  # build RF on training data
  set.seed(1234) 
  rf_yield <- randomForest(YIELD ~ ., data = train, mtry = index, ntree = 2000)
  rf_yield
  
  # build predictions on test set
  preds <- predict(rf_yield, test, type = "response")
  test$PREDICTIONS <- preds
  
  # build MSE/RMSE
  RMSE <- caret::RMSE(test$PREDICTIONS, test$YIELD)
  R2 <- 1 - (sum((test$YIELD - test$PREDICTIONS)^2)/sum((test$YIELD - mean(test$YIELD))^2))
  
  # build clean dataframe
  colnames(test)[2] <- paste0('YIELD_',index)
  colnames(test)[21] <- paste0('PREDS_',index)
  
  # importance plots
  imp <- as.data.frame(importance(rf_yield))
  imp$varnames <- rownames(imp) # row names to column
  
  colnames(imp)[1] <- paste0('IncPurity_',index)
  
  # build argument to feed save, below
  list <- list("RMSE" = RMSE, "R2" = R2, "var_exp" = rf_yield)
  
  # return
  saveRDS(imp, file = paste0('./results-imp/RFimp_',index,'.RDS'))
  return(list)

}

rf_mtry_1 <- rf_mtry(1)
rf_mtry_1
rf_mtry_2 <- rf_mtry(2)
rf_mtry_2
rf_mtry_3 <- rf_mtry(3)
rf_mtry_3
rf_mtry_4 <- rf_mtry(4)
rf_mtry_4
rf_mtry_5 <- rf_mtry(5)
rf_mtry_5
rf_mtry_6 <- rf_mtry(6)
rf_mtry_6
rf_mtry_7 <- rf_mtry(7)
rf_mtry_7
rf_mtry_8 <- rf_mtry(8)
rf_mtry_8
rf_mtry_9 <- rf_mtry(9)
rf_mtry_9
rf_mtry_10 <- rf_mtry(10)
rf_mtry_10
rf_mtry_11 <- rf_mtry(11)
rf_mtry_11
rf_mtry_12 <- rf_mtry(12)
rf_mtry_12
```
# Tune Farm(er) RF

Default mtry = p/3 (so 30/3); but tuning suggests that mtry = 12 minimizing cross-validated RMSE!
```{r evaluate = FALSE}

farmer <- train_fullset %>% 
  dplyr::select(YEAR,YIELD,PERC_IRR,FRR,GDD,BV2,BV18,SDI_CDL_AG,BV9,BV4,TP,ELEVATION,S_PH_H2O,SLOPE,BV8,BV19,T_CEC_SOIL,BV15,T_REF_BULK_DENSITY,T_OC,29:39)
  
control <- trainControl(method="repeatedcv", 
                        number=10, 
                        repeats=3, 
                        search="grid")
set.seed(1234)

tunegrid <- expand.grid(.mtry=c(4:20))

rf_farmer_gridsearch <- train(YIELD~., data=farmer, 
                       method="rf", 
                       metric='RMSE', 
                       ntree = 2000,
                       tuneGrid=tunegrid,
                       trControl = control)
print(rf_farmer_gridsearch)

jpeg("./viz/rf-farmer-tune-mtry.jpeg", height = 4, width = 6, units = "in", res = 400)
plot(rf_farmer_gridsearch)
dev.off()

```

# Bring in data, again
```{r}
# pull in TRUE train data; all data with recorded yield
corn_yield <- readRDS("./data/yieldRF.RDS")

# remove ID variables that aren't included in the model
yield_RF <- corn_yield %>% dplyr::select(-c(GEOID, 30:40))

# specify qualitative variables that are factors
yield_RF$YEAR <- as.factor(yield_RF$YEAR)
yield_RF$FRR <- as.factor(yield_RF$FRR)

# reduced variable set
yield_RF_bioph <- yield_RF %>% 
  dplyr::select(YEAR,YIELD,PERC_IRR,FRR,GDD,BV2,BV18,SDI_CDL_AG,BV9,BV4,TP,ELEVATION,S_PH_H2O,SLOPE,BV8,BV19,T_CEC_SOIL,BV15,T_REF_BULK_DENSITY,T_OC)

# bring in true test
truetest <- readRDS("./data/true-test-infillobs.RDS")

infill_bioph <- truetest %>% 
  dplyr::select(YEAR,YIELD,PERC_IRR,FRR,GDD,BV2,BV18,SDI_CDL_AG,BV9,BV4,TP,ELEVATION,S_PH_H2O,SLOPE,BV8,BV19,T_CEC_SOIL,BV15,T_REF_BULK_DENSITY,T_OC)
```


# Iterations
```{r}
for (iter in 1:100){
  cat(paste('iter = ', iter, ':: '))
  
  # build training and test sets, iteratively
  random_rn <- sample(nrow(yield_RF_bioph), ceiling(nrow(yield_RF_bioph)*.25)) 
  train <- yield_RF_bioph[-random_rn,] 
  test <- yield_RF[random_rn,] 
  
  # save the summary statistics for each test set
  sum_stat <- test %>% 
  summarise(mean = mean(YIELD),
           median = median(YIELD),
           sd = sd(YIELD))
  
  # train the model
  rf <- randomForest(YIELD ~ ., data = train)
  
  # test the model
  preds <- predict(rf, test, type = "response")
  test$PREDICTIONS <- preds

  # performance on test set
  RMSE <- caret::RMSE(test$PREDICTIONS, test$YIELD)
  R2 <- 1 - (sum((test$YIELD - test$PREDICTIONS)^2) / sum((test$YIELD - mean(test$YIELD))^2))
  
  # build argument to feed save, below
  list <- list("RMSE" = RMSE, "R2" = R2, "var_exp" = rf_yield)
  print(list)
  
  # variable importance
  imp <- as.data.frame(varImpPlot(rf))
  colnames(imp)[1] <- paste0('IncPurity_',iter)
  
  # save .csv's
  write.csv(test, file = paste0('./results-preds/RFpreds_',iter,'.csv'))
  write.csv(imp, file = paste0('./results-imp/RFimp_',iter,'.csv'))
  write.csv(sum_stat, file = paste0('./results-ss/ss_',iter,'.csv'))

}
```

# Partial dependence plots
```{r}
# year
partialPlot(rf_yield_reduced,yield_RF_reduced,"YEAR")
# irrigation
irrs <- yield_RF_reduced %>% summarise(mean = mean(PERC_IRR), sd = sd(PERC_IRR))
irrp <- as.data.frame(partialPlot(rf_yield_reduced,yield_RF_reduced,"PERC_IRR"))
irrp$VAR = "Irrigation (% ag acres)"  
irrps <- irrp %>% mutate(xs = (x - irrs$mean) / irrs$sd)
# corn sq km
corns <- yield_RF_reduced %>% summarise(mean = mean(CORN_SQKM), sd = sd(CORN_SQKM))
cornp <- as.data.frame(partialPlot(rf_yield_reduced,yield_RF_reduced,"CORN_SQKM"))
cornp$VAR <- "Area cultivated in corn (sq km)"
cornps <- cornp %>% mutate(xs = (x - corns$mean) / corns$sd)
# GDD
gdds <- yield_RF_reduced %>% summarise(mean = mean(GDD), sd = sd(GDD))
gddp <- as.data.frame(partialPlot(rf_yield_reduced,yield_RF_reduced,"GDD"))
gddp$VAR <- "Growing degree days (C)"
gddps <- gddp %>% mutate(xs = (x - gdds$mean) / gdds$sd)
# BV18
bv18s <- yield_RF_reduced %>% summarise(mean = mean(BV18), sd = sd(BV18))
bv18p <- as.data.frame(partialPlot(rf_yield_reduced,yield_RF_reduced,"BV18"))
bv18p$VAR <- "Precipitation of warmest quarter (mm)"
bv18ps <- bv18p %>% mutate(xs = (x - bv18s$mean) / bv18s$sd)
# BV2
partialPlot(rf_yield_reduced,yield_RF_reduced,BV2)
bv2s <- yield_RF_reduced %>% summarise(mean = mean(BV2), sd = sd(BV2))
bv2p <- as.data.frame(partialPlot(rf_yield_reduced,yield_RF_reduced,"BV2"))
bv2p$VAR <- "Mean diurnal range (C)"
bv2ps <- bv2p %>% mutate(xs = (x - bv2s$mean) / bv2s$sd)
# SDI
SDIs <- yield_RF_reduced %>% summarise(mean = mean(SDI_CDL_AG), sd = sd(SDI_CDL_AG))
sdip <- as.data.frame(partialPlot(rf_yield_reduced,yield_RF_reduced,"SDI_CDL_AG"))
sdip$VAR <- "Shannon's Diversity Index"
sdips <- sdip %>% mutate(xs = (x - SDIs$mean) / SDIs$sd)

# merge into one dataframe
pdp <- rbind(irrps,cornps,gddps,bv18ps,bv2ps,sdips)

input_pp <- ggplot(pdp) +   
  geom_line(aes(x = xs, y = y, color = VAR), size = 1.2) + 
  theme_classic() +
  theme(legend.title = element_blank(), legend.position = "bottom" ) + 
  scale_colour_manual(values=c("#336633", "#99CC99", "#CC6633", "#4A7DA5", "#99CCFF", "#CCCC99")) +
  labs(x = "Standardized values",        
       y = "Predicted Yield (bu/acre)") +   
  theme(text = element_text(size=12)) 

input_pp

ggsave(input_pp, file = './viz/RFpdp_multiple.png', dpi = 300)
```

---

# Potential Trash Below

### Subset RFs by year
```{r}
# remove variables that contributed least to the full model
rf_year <- function(year) {
  
  #index
  index <- year
  
  # build data
  yield_RF <- yield_RF_reduced %>% 
  filter(YEAR == year) %>% 
  dplyr::select(-c(YEAR))
  
  # build training and test sets
  set.seed(1234) 
  random_rn <- sample(nrow(yield_RF), ceiling(nrow(yield_RF)*.25)) 
  train <- yield_RF[-random_rn,] 
  test <- yield_RF[random_rn,] 
  
  sum_stat <- test %>% 
    summarise(mean = mean(YIELD),
           median = median(YIELD),
           sd = sd(YIELD))
  
  # build RF on training data
  rf_yield <- randomForest(YIELD ~ ., data = train)
  rf_yield
  
  # build predictions on test set
  preds <- predict(rf_yield, test, type = "response")
  test$PREDICTIONS <- preds
  
  # build MSE/RMSE
  MSE <- mean((test$YIELD - test$PREDICTIONS)^2)
  RMSE <- caret::RMSE(test$PREDICTIONS, test$YIELD)
  R2 <- 1 - (sum((test$YIELD - test$PREDICTIONS)^2)/sum((test$YIELD - mean(test$YIELD))^2))
  pR2 <- 1 - MSE / var(test$YIELD)
  
  # build clean dataframe
  colnames(test)[1] <- paste0('YIELD_',index)
  colnames(test)[22] <- paste0('PREDS_',index)
  
  # importance plots
  imp <- as.data.frame(importance(rf_yield))
  imp$varnames <- rownames(imp) # row names to column
  
  imp_plot <- ggplot(imp, aes(x=reorder(varnames, IncNodePurity), y=IncNodePurity)) + 
  geom_point() +
  geom_segment(aes(x=varnames,xend=varnames,y=0,yend=IncNodePurity)) +
  ylab("Increase in node purity") +
  xlab("") +
  coord_flip() +
  theme_minimal()
  
  colnames(imp)[1] <- paste0('IncPurity_',index)
  
  # build argument to feed save, below
  list <- list("MSE" = MSE, "RMSE" = RMSE, "R2" = R2, "pR2" = pR2, "var_exp" = rf_yield)
  
  # return
  saveRDS(test, file = paste0('./results/RFpreds_',index,'.RDS'))
  saveRDS(imp, file = paste0('./results/RFimp_',index,'.RDS'))
  saveRDS(sum_stat, file = paste0('./results/ss_',index,'.RDS'))
  ggsave(imp_plot, file = paste0('./viz/RFimpplot_',index,'.png'))
  return(list)

}

rf_2008 <- rf_year(2008)
rf_2009 <- rf_year(2009)
rf_2010 <- rf_year(2010)
rf_2011 <- rf_year(2011)
rf_2012 <- rf_year(2012)
rf_2013 <- rf_year(2013)
rf_2014 <- rf_year(2014)
rf_2015 <- rf_year(2015)
rf_2016 <- rf_year(2016)
rf_2017 <- rf_year(2017)
rf_2018 <- rf_year(2018)
```


### Subset RFs by FRR
```{r}
# remove variables that contributed least to the full model
rf_frr <- function(frr) {
  
  #index
  index <- frr
  
  # build data
  yield_RF <- yield_RF_reduced %>% 
  filter(FRR == frr) %>% 
  dplyr::select(-c(FRR))
  
  # build training and test sets
  set.seed(1234) 
  random_rn <- sample(nrow(yield_RF), ceiling(nrow(yield_RF)*.25)) 
  train <- yield_RF[-random_rn,] 
  test <- yield_RF[random_rn,] 
  
  sum_stat <- test %>% 
  summarise(mean = mean(YIELD),
           median = median(YIELD),
           sd = sd(YIELD))
    
  # build RF on training data
  rf_yield <- randomForest(YIELD ~ ., data = train)
  rf_yield
  
  # build predictions on test set
  preds <- predict(rf_yield, test, type = "response")
  test$PREDICTIONS <- preds
  
  # build MSE/RMSE
  MSE <- mean((test$YIELD - test$PREDICTIONS)^2)
  RMSE <- caret::RMSE(test$PREDICTIONS, test$YIELD)
  R2 <- 1 - (sum((test$YIELD - test$PREDICTIONS)^2) / sum((test$YIELD - mean(test$YIELD))^2))
  pR2 <- 1 - MSE / var(test$YIELD)
  
  # build clean dataframe
  colnames(test)[22] <- paste0('PREDS_',index)
  test <- test %>% mutate(FRR = paste0('FRR',index))
  
  # importance plots
  imp <- as.data.frame(importance(rf_yield))
  imp$varnames <- rownames(imp) # row names to column
  
  imp_plot <- ggplot(imp, aes(x=reorder(varnames, IncNodePurity), y=IncNodePurity)) + 
  geom_point() +
  geom_segment(aes(x=varnames,xend=varnames,y=0,yend=IncNodePurity)) +
  ylab("Increase in node purity") +
  xlab("") +
  coord_flip() +
  theme_minimal()
    
  colnames(imp)[1] <- paste0('IncPurity_',index)
  
  # build argument to feed save, below
  list <- list("MSE" = MSE, "RMSE" = RMSE, "R2" = R2, "pR2" = pR2, "var_exp" = rf_yield, "pR2" = pR2)
  
  # return
  saveRDS(test, file = paste0('./results/RFpreds_',index,'.RDS'))
  saveRDS(imp, file = paste0('./results/RFimp_',index,'.RDS'))
  saveRDS(sum_stat, file = paste0('./results/ss_',index,'.RDS'))
  ggsave(imp_plot, file = paste0('./viz/RFimpplot_',index,'.png'))
  return(list)

}

rf_1 <- rf_frr(1)
rf_2 <- rf_frr(2)
rf_3 <- rf_frr(3)
rf_4 <- rf_frr(4)
rf_5 <- rf_frr(5)
rf_6 <- rf_frr(6)
rf_7 <- rf_frr(7)
rf_8 <- rf_frr(8)
rf_9 <- rf_frr(9)

#test <- RFpreds_8 %>% select(YIELD, PREDS_8)
```
